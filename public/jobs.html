<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Job Seeker Portal | Ntchito</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
  /* ========== RESET & BASE ========== */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  body {
    font-family: "Inter", sans-serif;
    background: #f9fafb;
    color: #222;
    line-height: 1.6;
  }
  a {
    text-decoration: none;
    color: inherit;
    transition: 0.3s;
  }

 
.center-modal {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 40px 0;
}

  /* ========== HEADER ========== */
  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 60px;
    background: white;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    position: sticky;
    top: 0;
    z-index: 10;
  }
  header h1 {
    font-size: 1.8rem;
    font-weight: 700;
    color: #bb0303;
    letter-spacing: 1px;
  }
  header nav a {
    margin-left: 25px;
    font-weight: 500;
    color: #555;
    position: relative;
  }
  header nav a::after {
    content: "";
    position: absolute;
    bottom: -5px;
    left: 0;
    width: 0%;
    height: 2px;
    background: #bb0303;
    transition: width 0.3s ease;
  }
  header nav a:hover {
    color: #bb0303;
  }
  header nav a:hover::after {
    width: 100%;
  }

  /* ========== HERO SECTION ========== */
  .hero {
    background: linear-gradient(135deg, #0a66c2, #0073b1);
    color: white;
    text-align: center;
    padding: 120px 30px;
    background-image: url('assets/img/img (2).jpg');
    background-size: cover;
    background-position: center;
    background-blend-mode: overlay;
  }
  .hero h2 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 15px;
  }
  .hero p {
    font-size: 1.1rem;
    opacity: 0.9;
  }

  /* ========== JOBS SECTION ========== */
  #jobsSection {
    max-width: 1100px;
    margin: 60px auto;
    padding: 0 20px;
  }
  .section-title {
    font-size: 1.8rem;
    margin-bottom: 25px;
    color: #cb0e00;
    font-weight: 700;
  }
  .job-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
  }
  .job-card {
    background: white;
    border-radius: 10px;
    padding: 25px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    transition: 0.3s;
  }
  .job-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
  }
  .job-card h4 {
    font-size: 1.2rem;
    margin-bottom: 8px;
    color: #0a66c2;
  }
  .job-card p {
    font-size: 0.95rem;
    color: #555;
  }
  .apply-btn {
    display: inline-block;
    margin-top: 12px;
    padding: 8px 18px;
    border-radius: 20px;
    background: #0a66c2;
    color: white;
    font-weight: 600;
    transition: 0.3s;
  }
  .apply-btn:hover {
    background: #084d96;
  }

  /* ========== FOOTER ========== */
  footer {
    text-align: center;
    padding: 25px;
    background: #bb0303;
    color: white;
    margin-top: 60px;
    font-size: 0.9rem;
  }

  /* ========== RESPONSIVE ========== */
  @media (max-width: 768px) {
    header {
      flex-direction: column;
      text-align: center;
      padding: 15px;
    }
    header nav a {
      margin: 10px;
      display: inline-block;
    }
    .hero h2 {
      font-size: 2rem;
    }
  }
</style>

</head>
<body>
  <header>
    <h1>Ntchito</h1>
    <nav>
      <a href="#">Home</a>
      <a href="#">Find Jobs</a>
      <a href="#">Employers</a>
      <a href="#">Contact</a>
    </nav>
  </header>

  <section class="hero">
    <h2>Find your next opportunity</h2>
    <p>Search jobs across SADC and grow your career effortlessly.</p>
  </section>

  <section id="jobsSection" style="display:none;">
    <h3 class="section-title">Recommended Jobs for You</h3>
    <div id="jobsList" class="job-list"></div>
  </section>



  <!-- ======= Onboarding Modal ======= -->
  <style>
  /* ===== Reset & Base ===== */
  *{box-sizing:border-box;margin:0;padding:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
  :root{
     --primary: #ad0303;
    --muted:#68707d;
    --bg:#f5f7fb;
    --card:#ffffff;
    --radius:12px;
    --step-size:44px;
  }

  /* ===== Modal ===== */
  .modal{width:100%;max-width:820px;background:var(--card);border-radius:16px;box-shadow:0 20px 50px rgba(16,24,40,0.12);overflow:hidden;border:1px solid rgba(99,102,241,0.06)}
  .container{display:grid;grid-template-columns:320px 1fr;min-height:560px}
  @media(max-width:880px){ .container{grid-template-columns:1fr} }

  /* ===== Left Panel (Stepper) ===== */
  .left{
    background:linear-gradient(180deg, rgba(108,99,255,0.06), rgba(108,99,255,0.02));
    padding:22px;
    border-right:1px solid rgba(16,24,40,0.03);
  }
  .brand{display:flex;gap:12px;align-items:center;margin-bottom:18px}
  .brand .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--primary),#4b46d9);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
  .brand h3{font-size:16px;color:#111827}
  .steps{margin-top:8px}
  .step-item{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;cursor:pointer;transition:all .25s}
  .step-item:hover{background:rgba(99,102,241,0.04)}
  .step-icon{width:var(--step-size);height:var(--step-size);display:flex;align-items:center;justify-content:center;border-radius:10px;border:1px solid rgba(99,102,241,0.12);color:var(--muted)}
  .step-labels{display:flex;flex-direction:column}
  .step-labels .title{font-weight:600;color:#0f172a;font-size:13px}
  .step-labels .subtitle{font-size:12px;color:var(--muted)}
  .step-item.active .step-icon{background:var(--primary);color:white;border-color:transparent;box-shadow:0 6px 18px rgba(99,102,241,0.18)}
  .progress-line{height:8px;background:transparent;margin-top:20px;border-radius:999px;position:relative;overflow:hidden}
  .progress-bg{position:absolute;left:0;right:0;top:0;bottom:0;background:#eef2ff}
  .progress-fill{position:absolute;left:0;top:0;bottom:0;background:linear-gradient(90deg,var(--primary),#4b46d9);width:0%;transition:width .45s cubic-bezier(.2,.9,.25,1)}
  @media(max-width:880px){ .left{order:2;padding:16px} .progress-line{display:block;margin-top:12px} }

  /* ===== Right Panel (Steps content) ===== */
  .right{padding:28px 30px}
  .step-content{display:none;opacity:0;transform:translateY(12px);transition:all .45s cubic-bezier(.2,.9,.25,1)}
  .step-content.active{display:block;opacity:1;transform:none}
  h2{font-size:20px;margin-bottom:10px;color:#0f172a}
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
  .row{display:flex;gap:12px}
  .col{flex:1}
  input[type="text"],input[type="email"],input[type="tel"],input[type="date"],select,textarea{
    width:100%;padding:12px 14px;border-radius:10px;border:1px solid #e6e9f2;background:white;font-size:14px;color:#0f172a;transition:box-shadow .18s,border-color .18s;
  }
  input:focus,select:focus,textarea:focus{outline:none;box-shadow:0 6px 20px rgba(99,102,241,0.08);border-color:var(--primary)}
  .small{font-size:13px;color:var(--muted);margin-bottom:10px}
  .actions{display:flex;justify-content:flex-end;gap:10px;margin-top:18px}
  .btn{padding:10px 14px;border-radius:10px;border:none;background:var(--primary);color:white;cursor:pointer;font-weight:600;box-shadow:0 8px 20px rgba(99,102,241,0.12)}
  .btn.ghost{background:transparent;color:var(--muted);border:1px solid rgba(15,23,42,0.06)}
  .btn.secondary{background:#111827;color:white}

  /* ===== Phone with flag & code ===== */
  .phone-wrap{display:flex;gap:8px;align-items:center}
  .flag-block{display:flex;align-items:center;gap:8px;padding:8px 10px;border-radius:10px;background:#fff;border:1px solid #e6e9f2;min-width:120px}
  .flag-emoji{font-size:20px}
  .country-code{font-weight:600;color:#111827}
  .phone-input{flex:1}

  /* ===== Suggestions & Chips ===== */
  .suggestions{margin-top:6px;border:1px solid #eef2ff;border-radius:10px;background:white;max-height:140px;overflow:auto}
  .suggestion-item{padding:8px 12px;cursor:pointer}
  .suggestion-item:hover{background:#f3f4ff}
  .chip-container{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
  .chip{background:rgba(108,99,255,0.14);color:var(--primary);padding:6px 10px;border-radius:999px;font-weight:600;display:inline-flex;gap:8px;align-items:center}
  .chip button{background:transparent;border:none;color:var(--primary);cursor:pointer;font-weight:800;padding:0}

  /* ===== Multi-select nicer styling (job type) ===== */
  select[multiple]{height:120px;padding:12px;border-radius:10px}

  /* ===== Education cards area ===== */
  .edu-controls{display:flex;align-items:center;gap:8px;margin-bottom:12px}
  .edu-list{display:flex;flex-direction:column;gap:12px;margin-top:12px}
  .edu-card{background:#fff;border-radius:10px;padding:12px;border:1px solid #eef2ff;display:flex;align-items:center;justify-content:space-between}
  .edu-info{display:flex;flex-direction:column;gap:6px}
  .edu-actions{display:flex;gap:8px}
  .badge{font-size:12px;color:var(--muted);background:rgba(15,23,42,0.03);padding:6px 8px;border-radius:8px}

  /* ===== Links popup ===== */
  .overlay{position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(2,6,23,0.45);display:flex;align-items:center;justify-content:center;z-index:200}
  .popup{background:white;padding:18px;border-radius:12px;width:420px;box-shadow:0 20px 60px rgba(2,6,23,0.2)}

  /* ===== Success screen & confetti ===== */
  .success-screen{display:none;padding:34px;text-align:center}
  .success-screen.active{display:block}
  .check{width:92px;height:92px;border-radius:999px;margin:16px auto;background:linear-gradient(90deg,var(--primary),#4b46d9);display:flex;align-items:center;justify-content:center;color:white;font-size:44px;box-shadow:0 12px 40px rgba(99,102,241,0.18)}
  .success-screen p{color:var(--primary);font-weight:700;margin-top:8px}
  /* Confetti canvas */
  #confettiCanvas{position:absolute;left:0;top:0;pointer-events:none;z-index:150}

  /* small */
  .muted{color:var(--muted);font-size:13px}
  .field-row{margin-bottom:12px}
</style>

<!-- Confetti canvas -->
<canvas id="confettiCanvas"></canvas>

<div class="center-modal">
<div class="modal" id="modal">
  <div class="container">

    <!-- LEFT: stepper + progress -->
    <aside class="left">
      <div class="brand">
        <div class="logo">JS</div>
        <div>
          <h3>Job Seeker Signup</h3>
          <div class="muted">Setup your profile — 7 quick steps</div>
        </div>
      </div>

      <div class="steps" id="stepsList">
        <!-- Step items will be rendered by JS for dynamic active states -->
      </div>

      <div class="progress-line" aria-hidden>
        <div class="progress-bg"></div>
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </aside>

    <!-- RIGHT: content -->
    <main class="right">

      <!-- STEP 1: Username, Gender, DOB -->
      <section class="step-content active" data-step="1" id="step-1">
        <h2>1. Basic info</h2>
        <div class="field-row">
          <label for="username">Preferred username</label>
          <input id="username" type="text" placeholder="e.g. jane.dev42" />
        </div>

        <div class="row">
          <div class="col field-row">
            <label for="gender">Gender</label>
            <select id="gender" aria-label="gender">
              <option value="">Choose gender</option>
              <option value="female">Female</option>
              <option value="male">Male</option>
              <option value="nonbinary">Non-binary</option>
              <option value="other">Other / Prefer not to say</option>
            </select>
          </div>
          <div class="col field-row">
            <label for="dob">Date of birth</label>
            <input id="dob" type="date" />
          </div>
        </div>

        <div class="actions">
          <button class="btn ghost" onclick="goStep(2)">Next →</button>
        </div>
      </section>

      <!-- STEP 2: Country > District > Town + phone w/ flag & code -->
      <section class="step-content" data-step="2" id="step-2">
        <h2>2. Location & phone</h2>

        <div class="field-row">
          <label for="country">Country (SADC)</label>
          <select id="country">
            <option value="">Select country</option>
            <option value="ZW">Zimbabwe</option>
            <option value="ZA">South Africa</option>
            <option value="BW">Botswana</option>
            <option value="NA">Namibia</option>
            <option value="MZ">Mozambique</option>
            <option value="ZM">Zambia</option>
            <option value="TZ">Tanzania</option>
          </select>
        </div>

        <div class="row">
          <div class="col field-row">
            <label for="district">District / Province</label>
            <select id="district"><option value="">Select district</option></select>
          </div>
          <div class="col field-row">
            <label for="town">Town</label>
            <select id="town"><option value="">Select town</option></select>
          </div>
        </div>

        <div class="field-row">
          <label for="phone">Phone number</label>
          <div class="phone-wrap">
            <div class="flag-block" id="flagBlock" aria-hidden>
              <div class="flag-emoji" id="flagEmoji">🏳️</div>
              <div class="country-code" id="countryCode">+000</div>
            </div>
            <div class="phone-input" style="flex:1">
              <input id="phone" type="tel" placeholder="e.g. 772 123 456" />
              <div class="muted" style="margin-top:6px">Country code is auto-filled from selected country</div>
            </div>
          </div>
        </div>

        <div class="actions">
          <button class="btn ghost" onclick="goStep(1)">← Back</button>
          <button class="btn" onclick="goStep(3)">Next →</button>
        </div>
      </section>

      <!-- STEP 3: Interests (suggestions, chips) -->
      <section class="step-content" data-step="3" id="step-3">
        <h2>3. What are your interests</h2>

        <label for="interestInput">Type and select from suggestions (max 7)</label>
        <input id="interestInput" type="text" placeholder="e.g. JavaScript, UX, Marketing..." oninput="showSuggestions(this.value)" />
        <div class="suggestions" id="suggestionsBox" role="listbox" aria-label="suggestions"></div>
        <div class="chip-container" id="chipsWrap" aria-live="polite"></div>

        <div class="small muted">We show suggestions when you type; click one to add it. You can add custom ones too (press Enter).</div>

        <div class="actions">
          <button class="btn ghost" onclick="goStep(2)">← Back</button>
          <button class="btn" onclick="goStep(4)">Next →</button>
        </div>
      </section>

      <!-- STEP 4: Job Prefs (multi select) -->
      <section class="step-content" data-step="4" id="step-4">
        <h2>4. Job preferences</h2>

        <div class="field-row">
          <label for="jobtype">Preferred work type (multi-select)</label>
          <select id="jobtype" multiple>
            <option value="fulltime">Full-Time</option>
            <option value="parttime">Part-Time</option>
            <option value="freelance">Freelance</option>
            <option value="remote">Remote</option>
            <option value="hybrid">Hybrid</option>
          </select>
        </div>

        <div class="field-row">
          <label for="desiredjob">Desired job titles (comma-separated)</label>
          <input id="desiredjob" type="text" placeholder="e.g. Frontend Engineer, Product Designer" />
        </div>

        <div class="actions">
          <button class="btn ghost" onclick="goStep(3)">← Back</button>
          <button class="btn" onclick="goStep(5)">Next →</button>
        </div>
      </section>

      <!-- STEP 5: Education stage with cards -->
      <section class="step-content" data-step="5" id="step-5">
        <h2>5. Education</h2>

        <div class="edu-controls">
          <button class="btn ghost" id="addEduBtn">+ Add education</button>
          <div class="muted">You can create up to 7 education cards</div>
        </div>

        <div id="eduFormArea">
          <!-- A template dynamic area will appear to enter one education before "Done" -->
        </div>

        <div class="edu-list" id="eduList"></div>

        <div class="actions">
          <button class="btn ghost" onclick="goStep(4)">← Back</button>
          <button class="btn" onclick="goStep(6)">Next →</button>
        </div>
      </section>

      <!-- STEP 6: Additional info (links popup) -->
      <section class="step-content" data-step="6" id="step-6">
        <h2>6. Additional links</h2>

        <div style="display:flex;gap:10px;align-items:center;margin-bottom:12px">
          <button class="btn ghost" onclick="openLinkPopup()">+ Add link</button>
          <div class="muted">Add portfolio, website, profiles</div>
        </div>

        <div id="linksArea"></div>

        <div class="actions">
          <button class="btn ghost" onclick="goStep(5)">← Back</button>
          <button class="btn" onclick="goStep(7)">Next →</button>
        </div>
      </section>

      <!-- STEP 7: Review & Submit -->
      <section class="step-content" data-step="7" id="step-7">
        <h2>7. Review & Submit</h2>

        <div id="reviewArea" class="muted" style="margin-bottom:18px"></div>

        <div class="actions">
          <button class="btn ghost" onclick="goStep(6)">← Back</button>
          <button class="btn secondary" onclick="submitProfile()">Submit</button>
        </div>
      </section>

      <!-- Success Screen -->
      <section class="success-screen" id="successScreen">
        <div class="check">✓</div>
        <p>Profile submitted successfully!</p>
        <div class="muted">We sent a confirmation to your email (if provided).</div>
      </section>

    </main>
  </div>
</div></div>

<!-- links popup template -->
<div id="linkPopup" style="display:none;">
  <div class="overlay" id="overlay" onclick="closeLinkPopup()">
    <div class="popup" onclick="event.stopPropagation()">
      <h3 style="margin-bottom:8px">Add link</h3>
      <label for="linkName">Name (e.g. Portfolio)</label>
      <input id="linkName" type="text" placeholder="e.g. Portfolio" />
      <label for="linkUrl" style="margin-top:8px">URL / Address</label>
      <input id="linkUrl" type="text" placeholder="https://..." />
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
        <button class="btn ghost" onclick="closeLinkPopup()">Cancel</button>
        <button class="btn" onclick="saveLink()">Save</button>
      </div>
    </div>
  </div>
</div>
  <canvas id="confettiCanvas"></canvas>
  <footer>
    © 2025 Ntchito Careers — All Rights Reserved.
  </footer>
  <!-- ======================= FULL SCRIPT ======================= -->
<script src="https://unpkg.com/feather-icons@4.29.2/dist/feather.min.js"></script>
 <script>
    feather.replace();
  </script>  
<script>
/* =============== Auto-popup logic =============== */
document.addEventListener('DOMContentLoaded', ()=>{
  const modal = document.getElementById('modal');
  const jobsSection = document.getElementById('jobsSection');
  const stored = loadState();

  if(stored && stored.username && stored.jobtype && stored.desiredjob){
    // Already onboarded → show jobs
    modal.style.display = 'none';
    jobsSection.style.display = 'block';
    populateJobs(stored);
  } else {
    // No data → show onboarding modal
    modal.style.display = 'block';
    jobsSection.style.display = 'none';
  }
});

/* =============== Populate jobs =============== */
function populateJobs(user){
  const jobs = [
    {title:"Frontend Developer",type:"fulltime",tags:["JavaScript","React","CSS"],location:"Harare"},
    {title:"UI/UX Designer",type:"remote",tags:["Design","Figma","User Research"],location:"Cape Town"},
    {title:"Marketing Executive",type:"hybrid",tags:["Marketing","Sales"],location:"Lusaka"},
    {title:"Data Analyst",type:"fulltime",tags:["SQL","Python","Excel"],location:"Johannesburg"},
    {title:"Backend Engineer",type:"freelance",tags:["Node.js","Databases"],location:"Bulawayo"}
  ];

  const userInterests = (user.interests || []).map(i=>i.toLowerCase());
  const preferredTypes = (user.jobtype || []).map(t=>t.toLowerCase());
  const desiredTitles = (user.desiredjob || '').toLowerCase().split(',').map(d=>d.trim());

  const matches = jobs.filter(j=>{
    const matchTitle = desiredTitles.some(t=>j.title.toLowerCase().includes(t));
    const matchInterest = userInterests.some(i=>j.tags.join(' ').toLowerCase().includes(i));
    const matchType = preferredTypes.includes(j.type);
    return matchTitle || matchInterest || matchType;
  });

  const list = document.getElementById('jobsList');
  list.innerHTML = '';

  if(matches.length===0){
    list.innerHTML = `<div style="color:#68707d;">No exact matches found, but we’ll keep searching for you.</div>`;
    return;
  }

  matches.forEach(job=>{
    const div = document.createElement('div');
    div.style.background = 'white';
    div.style.padding = '20px';
    div.style.borderRadius = '12px';
    div.style.boxShadow = '0 4px 14px rgba(0,0,0,0.06)';
    div.innerHTML = `
      <h3 style="color:#111827;font-size:18px">${job.title}</h3>
      <div style="color:#c72b20;font-weight:600;margin:4px 0">${job.location} • ${job.type}</div>
      <div style="color:#68707d;font-size:14px;">Tags: ${job.tags.join(', ')}</div>
    `;
    list.appendChild(div);
  });
}

/* =============== Override submitProfile =============== */
function submitProfile(){
  persistFromInputs();
  const state = loadState();
  document.getElementById('successScreen').classList.add('active');
  startConfetti();

  // Save permanently
  saveState(state);

  setTimeout(()=>{
    document.getElementById('modal').style.display='none';
    document.getElementById('jobsSection').style.display='block';
    populateJobs(state);
  }, 2000);
}
</script>

<script>
/* ===========================
  Helper & persistent data
=========================== */
const stepsMeta = [
  {id:1,label:'Basic',sub:'username, gender' ,icon:'user'},
  {id:2,label:'Location',sub:'country & phone' ,icon:'map-pin'},
  {id:3,label:'Interests',sub:'skills & interests' ,icon:'heart'},
  {id:4,label:'Job prefs',sub:'type & titles' ,icon:'briefcase'},
  {id:5,label:'Education',sub:'certificates' ,icon:'book'},
  {id:6,label:'Links',sub:'portfolio & sites' ,icon:'link'},
  {id:7,label:'Review',sub:'submit' ,icon:'check-circle'}
];

const districts = {
  'ZW':['Harare','Bulawayo','Manicaland','Mashonaland Central'],
  'ZA':['Gauteng','Western Cape','KwaZulu-Natal'],
  'BW':['Gaborone','Francistown'],
  'NA':['Khomas','Erongo'],
  'MZ':['Maputo','Beira'],
  'ZM':['Lusaka','Ndola'],
  'TZ':['Dar es Salaam','Dodoma']
};
const towns = {
  'Harare':['Harare CBD','Chisipite','Borrowdale'],
  'Bulawayo':['Khami','Nkulumane'],
  'Gauteng':['Johannesburg','Pretoria'],
  'Western Cape':['Cape Town','Stellenbosch'],
  'KwaZulu-Natal':['Durban','Pietermaritzburg'],
  'Maputo':['Maputo City'],
  'Lusaka':['Lusaka Central']
};
const countryData = {
  'ZW':{name:'Zimbabwe',flag:'🇿🇼',code:'+263'},
  'ZA':{name:'South Africa',flag:'🇿🇦',code:'+27'},
  'BW':{name:'Botswana',flag:'🇧🇼',code:'+267'},
  'NA':{name:'Namibia',flag:'🇳🇦',code:'+264'},
  'MZ':{name:'Mozambique',flag:'🇲🇿',code:'+258'},
  'ZM':{name:'Zambia',flag:'🇿🇲',code:'+260'},
  'TZ':{name:'Tanzania',flag:'🇹🇿',code:'+255'}
};

/* Auto-save keys & data */
const STORAGE_KEY = 'ntchito_v2';
function saveState(state){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}
function loadState(){ try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; } catch(e){ return {}; } }

/* initialize stepper UI */
const stepsList = document.getElementById('stepsList');
stepsMeta.forEach(s=>{
  const el = document.createElement('div');
  el.className = 'step-item';
  el.dataset.step = s.id;
  el.innerHTML = `
    <div class="step-icon"><i data-feather="${s.icon}"></i></div>
    <div class="step-labels"><div class="title">${s.id}. ${s.label}</div><div class="subtitle">${s.sub}</div></div>
  `;
  el.addEventListener('click', ()=>goStep(s.id));
  stepsList.appendChild(el);
});
feather.replace();

/* progress fill update */
function updateStepper(active){
  document.querySelectorAll('.step-item').forEach(si=>{
    si.classList.toggle('active', Number(si.dataset.step)===active);
  });
  const pct = ((active-1)/(stepsMeta.length-1))*100;
  document.getElementById('progressFill').style.width = pct + '%';
}

/* ===========================
  Step navigation
=========================== */
let current = 1;
function goStep(n){
  if(n<1 || n>7) return;
  // save before moving
  persistFromInputs();
  current = n;
  // show/hide panels
  document.querySelectorAll('.step-content').forEach(sec=>{
    sec.classList.toggle('active', Number(sec.dataset.step)===n);
  });
  // hide success screen if moving backwards
  document.getElementById('successScreen').classList.remove('active');
  // update left steps
  updateStepper(n);
  // restore review content if step 7
  if(n===7) renderReview();
}

/* ===========================
  Step 2: Cascading dropdown + phone updates
=========================== */
const countrySelect = document.getElementById('country');
const districtSelect = document.getElementById('district');
const townSelect = document.getElementById('town');
countrySelect.addEventListener('change', ()=>{
  const code = countrySelect.value;
  districtSelect.innerHTML = '<option value="">Select district</option>';
  townSelect.innerHTML = '<option value="">Select town</option>';
  if(code && districts[code]) districts[code].forEach(d=>districtSelect.insertAdjacentHTML('beforeend', `<option value="${d}">${d}</option>`));
  // set flag and country code
  const cd = countryData[code];
  document.getElementById('flagEmoji').textContent = cd?cd.flag:'🏳️';
  document.getElementById('countryCode').textContent = cd?cd.code:'+000';
  persistFromInputs();
});
districtSelect.addEventListener('change', ()=>{
  const val = districtSelect.value;
  townSelect.innerHTML = '<option value="">Select town</option>';
  if(towns[val]) towns[val].forEach(t=>townSelect.insertAdjacentHTML('beforeend', `<option value="${t}">${t}</option>`));
  persistFromInputs();
});

/* ===========================
  Step 3: Interests suggestions & chips
=========================== */
const suggestions = ["JavaScript","Python","HTML","CSS","React","Node.js","SQL","Django","Marketing","Accounting","UI/UX","Project Management","Data Analysis","DevOps","Mobile","Sales"];
const suggestionsBox = document.getElementById('suggestionsBox');
const chipsWrap = document.getElementById('chipsWrap');
const interestInput = document.getElementById('interestInput');

function showSuggestions(q){
  suggestionsBox.innerHTML = '';
  if(!q) return;
  const lower = q.toLowerCase();
  const filtered = suggestions.filter(s=>s.toLowerCase().includes(lower) && !getChips().includes(s)).slice(0,6);
  filtered.forEach(s=>{
    const div = document.createElement('div');
    div.className = 'suggestion-item';
    div.textContent = s;
    div.onclick = ()=>{ addChip(s); interestInput.value=''; suggestionsBox.innerHTML=''; };
    suggestionsBox.appendChild(div);
  });
}

// Chips
function getChips(){ return Array.from(chipsWrap.querySelectorAll('.chip span')).map(s=>s.textContent); }
function addChip(label){
  if(getChips().length >=7) return alert('Max 7 interests');
  if(getChips().includes(label)) return;
  const chip = document.createElement('div'); chip.className='chip';
  chip.innerHTML = `<span>${label}</span><button aria-label="remove" onclick="this.parentElement.remove(); persistFromInputs()">✕</button>`;
  chipsWrap.appendChild(chip);
  persistFromInputs();
}
interestInput.addEventListener('keydown', (e)=>{
  if(e.key==='Enter' && interestInput.value.trim()){
    e.preventDefault();
    addChip(interestInput.value.trim());
    interestInput.value='';
    suggestionsBox.innerHTML='';
  }
});

/* ===========================
  Step 5: Education cards UI & logic
=========================== */
const eduFormArea = document.getElementById('eduFormArea');
const eduList = document.getElementById('eduList');
const addEduBtn = document.getElementById('addEduBtn');
let eduTempId = 0; // for in-progress forms
let savedEdu = []; // {id,title,certificateName,fileMeta}

addEduBtn.addEventListener('click', ()=>openEduForm());

function openEduForm(prefill){
  if(savedEdu.length >= 7) return alert('You can add up to 7 education records');
  renderEduForm(prefill || {degree:'',certificates:'',fileName:''});
}

function renderEduForm(data){
  eduFormArea.innerHTML = '';
  const form = document.createElement('div');
  form.style.border = '1px solid #eef2ff';
  form.style.padding = '12px';
  form.style.borderRadius = '10px';
  form.innerHTML = `
    <div class="field-row"><label>Highest education</label><input id="edu_degree" type="text" placeholder="e.g. Bachelor of Science in CS" value="${escapeHtml(data.degree||'')}"></div>
    <div class="field-row"><label>Certificates (comma-separated)</label><input id="edu_cert" type="text" placeholder="e.g. Cisco CCNA, AWS Cloud Practitioner" value="${escapeHtml(data.certificates||'')}"></div>
    <div class="field-row"><label>Upload certificate (optional)</label><input id="edu_file" type="file" /></div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
      <button class="btn ghost" onclick="closeEduForm()">Cancel</button>
      <button class="btn" onclick="doneEdu()">Done</button>
    </div>
  `;
  eduFormArea.appendChild(form);
  // if there's a file name prefilled, set an attribute for display (can't prefill file input)
}

function closeEduForm(){ eduFormArea.innerHTML=''; }

function doneEdu(){
  const degree = document.getElementById('edu_degree')?.value?.trim() || '';
  const cert = document.getElementById('edu_cert')?.value?.trim() || '';
  const fileInput = document.getElementById('edu_file');
  const fileName = fileInput && fileInput.files && fileInput.files[0] ? fileInput.files[0].name : '';
  if(!degree && !cert && !fileName) return alert('Please add at least some education info');
  const item = {id:Date.now(),degree,certificates:cert, fileName};
  savedEdu.push(item);
  renderEduCards();
  closeEduForm();
  persistFromInputs();
}

function renderEduCards(){
  eduList.innerHTML = '';
  savedEdu.forEach(it=>{
    const div = document.createElement('div'); div.className='edu-card';
    div.innerHTML = `<div class="edu-info"><div style="font-weight:700">${escapeHtml(it.degree)}</div><div class="muted">${escapeHtml(it.certificates)}</div></div>
      <div class="edu-actions"><div class="badge">${it.fileName?escapeHtml(it.fileName):'No file'}</div>
      <div style="display:flex;gap:8px">
        <button class="btn ghost" onclick='editEdu(${it.id})'>Edit</button>
        <button class="btn" onclick='removeEdu(${it.id})'>Remove</button>
      </div></div>`;
    eduList.appendChild(div);
  });
}

function editEdu(id){
  const found = savedEdu.find(e=>e.id===id);
  if(!found) return;
  // remove current then prefill form with its data (file cannot be restored)
  savedEdu = savedEdu.filter(e=>e.id!==id);
  renderEduCards();
  renderEduForm({degree:found.degree,certificates:found.certificates,fileName:found.fileName});
}

function removeEdu(id){
  savedEdu = savedEdu.filter(e=>e.id!==id);
  renderEduCards();
  persistFromInputs();
}

/* ===========================
  Step 6: Links popup
=========================== */
let links = []; // {id,name,url}
function openLinkPopup(){
  document.body.insertAdjacentHTML('beforeend', document.getElementById('linkPopup').innerHTML);
  document.getElementById('overlay').style.display='flex';
}
function closeLinkPopup(){ document.getElementById('overlay')?.remove(); }
function saveLink(){
  const name = document.getElementById('linkName').value.trim();
  const url = document.getElementById('linkUrl').value.trim();
  if(!name || !url) return alert('Please provide both a name and URL');
  links.push({id:Date.now(),name,url});
  renderLinks();
  closeLinkPopup();
  persistFromInputs();
}
function renderLinks(){
  const area = document.getElementById('linksArea');
  area.innerHTML = '';
  links.forEach(l=>{
    const div = document.createElement('div');
    div.className = 'edu-card';
    div.innerHTML = `<div class="edu-info"><div style="font-weight:700">${escapeHtml(l.name)}</div><div class="muted">${escapeHtml(l.url)}</div></div>
      <div class="edu-actions"><button class="btn ghost" onclick='editLink(${l.id})'>Edit</button><button class="btn" onclick='removeLink(${l.id})'>Remove</button></div>`;
    area.appendChild(div);
  });
}
function editLink(id){
  const found = links.find(l=>l.id===id);
  if(!found) return;
  openLinkPopup();
  document.getElementById('linkName').value = found.name;
  document.getElementById('linkUrl').value = found.url;
  // remove original; save will push edited as new entry
  links = links.filter(l=>l.id!==id);
}
function removeLink(id){ links = links.filter(l=>l.id!==id); renderLinks(); persistFromInputs(); }

/* ===========================
  Review area (step 7)
=========================== */
function renderReview(){
  persistFromInputs();
  const s = loadState();
  const area = document.getElementById('reviewArea');
  area.innerHTML = `
    <div><strong>Username:</strong> ${escapeHtml(s.username||'—')}</div>
    <div><strong>Gender:</strong> ${escapeHtml(s.gender||'—')}</div>
    <div><strong>DOB:</strong> ${escapeHtml(s.dob||'—')}</div>
    <div><strong>Location:</strong> ${escapeHtml((countryData[s.country]?.name)||'—')} / ${escapeHtml(s.district||'—')} / ${escapeHtml(s.town||'—')}</div>
    <div><strong>Phone:</strong> ${escapeHtml((s.country ? countryData[s.country]?.code : '') || '')} ${escapeHtml(s.phone||'—')}</div>
    <div><strong>Interests:</strong> ${escapeHtml((s.interests||[]).join(', ')||'—')}</div>
    <div><strong>Job types:</strong> ${escapeHtml(((s.jobtype||[])).join(', ')||'—')}</div>
    <div><strong>Desired titles:</strong> ${escapeHtml(s.desiredjob||'—')}</div>
    <div><strong>Education:</strong> ${(s.education||[]).length ? '' : '—'}</div>
  `;
  if((s.education||[]).length){
    s.education.forEach(ed=> {
      area.insertAdjacentHTML('beforeend', `<div class="muted" style="margin-top:8px;padding:8px;border-radius:8px;background:#f8fafc;border:1px solid #eef2ff">${escapeHtml(ed.degree)} <div class="muted">${escapeHtml(ed.certificates)} ${ed.fileName? ' • ' + escapeHtml(ed.fileName) : ''}</div></div>`);
    });
  }
  if((s.links||[]).length){
    area.insertAdjacentHTML('beforeend','<div style="margin-top:8px"><strong>Links:</strong></div>');
    s.links.forEach(l=> area.insertAdjacentHTML('beforeend', `<div class="muted" style="margin-top:6px">${escapeHtml(l.name)} — ${escapeHtml(l.url)}</div>`));
  }
}

/* ===========================
  Submit -> success + confetti
=========================== */
 

/* ===========================
  Persistence helpers: read inputs and save to localStorage
  (Note: file content cannot be stored; only file name is preserved)
=========================== */
function persistFromInputs(){
  const state = loadState();
  state.username = document.getElementById('username').value;
  state.gender = document.getElementById('gender').value;
  state.dob = document.getElementById('dob').value;
  state.country = document.getElementById('country').value;
  state.district = document.getElementById('district').value;
  state.town = document.getElementById('town').value;
  state.phone = document.getElementById('phone').value;
  state.interests = getChips();
  state.jobtype = Array.from(document.getElementById('jobtype').selectedOptions).map(o=>o.value);
  state.desiredjob = document.getElementById('desiredjob').value;
  state.education = savedEdu;
  state.links = links;
  saveState(state);
}

/* restore saved state on load */
window.addEventListener('load', ()=>{
  const state = loadState();
  updateStepper(1);
  if(state.username) document.getElementById('username').value = state.username;
  if(state.gender) document.getElementById('gender').value = state.gender;
  if(state.dob) document.getElementById('dob').value = state.dob;
  if(state.country){
    document.getElementById('country').value = state.country;
    // trigger change logic to populate districts
    const ev = new Event('change');
    document.getElementById('country').dispatchEvent(ev);
  }
  if(state.district) { setTimeout(()=>document.getElementById('district').value = state.district,100); }
  if(state.town) { setTimeout(()=>document.getElementById('town').value = state.town,150); }
  if(state.phone) document.getElementById('phone').value = state.phone;
  // chips (interests)
  (state.interests||[]).forEach(i=>addChip(i));
  // job prefs
  if(state.jobtype) Array.from(document.getElementById('jobtype').options).forEach(opt=>{ opt.selected = (state.jobtype||[]).includes(opt.value); });
  if(state.desiredjob) document.getElementById('desiredjob').value = state.desiredjob;
  // education & links
  savedEdu = state.education || [];
  renderEduCards();
  links = state.links || [];
  renderLinks();
});

/* ===========================
  Utility: escape HTML
=========================== */
function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

/* ===========================
  Simple confetti implementation
  (canvas based, light-weight)
=========================== */
const confettiCanvas = document.getElementById('confettiCanvas');
const ctx = confettiCanvas.getContext('2d');
let confettiPieces = [];
function resizeCanvas(){ confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight; }
window.addEventListener('resize', resizeCanvas); resizeCanvas();

function startConfetti(){
  confettiPieces = [];
  const colors = ['#6c63ff','#ff7ab6','#ffd166','#06d6a0','#4cc9f0'];
  const count = 120;
  for(let i=0;i<count;i++){
    confettiPieces.push({
      x: Math.random()*confettiCanvas.width,
      y: Math.random()*-confettiCanvas.height,
      r: 6 + Math.random()*8,
      d: Math.random()*count,
      tilt: Math.random()*10,
      color: colors[i%colors.length],
      speed: 1 + Math.random()*3,
      rotate: Math.random()*360,
      rotateSpeed: (Math.random()-0.5)*8
    });
  }
  requestAnimationFrame(renderConfetti);
  setTimeout(()=>{ confettiPieces = []; }, 5000);
}
function renderConfetti(){
  ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
  confettiPieces.forEach(p=>{
    p.y += p.speed;
    p.x += Math.sin(p.d) * 0.8;
    p.rotate += p.rotateSpeed;
    ctx.save();
    ctx.translate(p.x,p.y);
    ctx.rotate(p.rotate * Math.PI/180);
    ctx.fillStyle = p.color;
    ctx.fillRect(-p.r/2, -p.r/2, p.r, p.r*1.8);
    ctx.restore();
  });
  if(confettiPieces.length) requestAnimationFrame(renderConfetti);
}

/* ===========================
  helpers for escaping and debugging
=========================== */
window.persistFromInputs = persistFromInputs;
window.goStep = goStep;
window.addChip = addChip;
window.editEdu = editEdu;
window.removeEdu = removeEdu;
window.openLinkPopup = openLinkPopup;
window.closeLinkPopup = closeLinkPopup;
window.saveLink = saveLink;
window.removeLink = removeLink;

/* expose updateStepper initially */
updateStepper(1);
</script>
</body>
</html>
